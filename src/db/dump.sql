DROP TABLE ACCOUNTS;
DROP SEQUENCE SEQ_ACCOUNTS;

CREATE TABLE ACCOUNTS(
    ID INTEGER NOT NULL PRIMARY KEY,
    COMPLETE_NAME VARCHAR2(500) NOT NULL,
    EMAIL VARCHAR2(500) NOT NULL UNIQUE,
    PASSWORD VARCHAR2(64) NOT NULL,
    BIRTHDATE VARCHAR2(11) NOT NULL,
    ROLE NUMBER(1) NOT NULL,
    TOKEN VARCHAR2(32) NOT NULL UNIQUE,
    CREATED_AT DATE DEFAULT SYSDATE
);

CREATE TABLE EVENTS(
    ID_EVENT INTEGER NOT NULL PRIMARY KEY,
    TITLE VARCHAR(100) NOT NULL,
    DESCRIPTION VARCHAR(500) NOT NULL,
    REGISTER_DATE DATE DEFAULT SYSDATE,
    CATEGORIES VARCHAR(100) NOT NULL

);

CREATE TABLE BETS (
    ID_BET INTEGER NOT NULL,
    BET INTEGER NOT NULL,
    VALUE_BET NUMBER(*,2),
    ID_USER NUMBER(38,0) NOT NULL,
    ID_EVENT NUMBER(38,0) NOT NULL,

    CONSTRAINT PK_ID_BET PRIMARY KEY (ID_BET),
    CONSTRAINT FK_ID_USER FOREIGN KEY (ID_USER) REFERENCES ACCOUNTS (ID),
    CONSTRAINT FK_ID_EVENT FOREIGN KEY (ID_EVENT) REFERENCES EVENTS (ID_EVENT)
);



-- ADICIONAR TRATAMENTO DE ERRO PARA TOKEN OU EMAIL JÁ ADICIONADOS
CREATE SEQUENCE SEQ_ACCOUNTS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_EVENTS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_BETS START WITH 1 INCREMENT BY 1;



INSERT INTO ACCOUNTS (ID, COMPLETE_NAME, EMAIL, PASSWORD, ROLE, TOKEN)
VALUES( 
    SEQ_ACCOUNTS.NEXTVAL, 
    'Enzo Garofalo', 
    'enzo.g@puc', 
    '12312', 
    1, 
    DBMS_RANDOM.STRING('X', 32)
);

INSERT INTO ACCOUNTS (ID, COMPLETE_NAME, EMAIL, PASSWORD, ROLE, TOKEN)
VALUES( 
    SEQ_ACCOUNTS.NEXTVAL, 
    'Rogério Medina', 
    'rogerio@puc', 
    '123123', 
    1, 
    DBMS_RANDOM.STRING('X', 32)
);

COMMIT;

SELECT * FROM ACCOUNTS;


