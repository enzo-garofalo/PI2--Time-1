<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home do usuário</title>
    <script src="https://kit.fontawesome.com/3f09446719.js" crossorigin="anonymous"></script>
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous">
</head>
<body>
    <div class="container mt-4" style="padding: 20px;">
        <h1 class="mb-3"><b>Minha Carteira</b></h1>
    </div>
    <div class="container" style="padding: 20px;">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#ID</th>
                    <th>Tipo</th>
                    <th class="text-end">Valor (R$)</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody id="tabelaTransactions">
                <!-- as transações serão inseridas aqui -->
            </tbody>
        </table>
    
        <!-- Controles de Paginação -->
        <nav aria-label="Page navigation example">
          <ul class="pagination justify-content-end" id="pagination">
            <!-- Itens de paginação serão gerados dinamicamente -->
          </ul>
        </nav>
    </div>

    <script>
        const transacoesPorPagina = 5;
        let paginaAtual = 1;
        let transacoes = [];

        async function fetchTransactions(walletId) {
            try {
                const response = await fetch(`http://localhost:3000/api/transactions/${walletId}`);
                transacoes = await response.json();
                atualizarTabela();
                gerarPaginacao();
            } catch (error) {
                console.error('Erro ao buscar transações:', error);
            }
        }

        function atualizarTabela() {
            const tabelaTransactions = document.getElementById("tabelaTransactions");
            tabelaTransactions.innerHTML = "";

            const inicio = (paginaAtual - 1) * transacoesPorPagina;
            const fim = inicio + transacoesPorPagina;
            const transacoesPagina = transacoes.slice(inicio, fim);

            transacoesPagina.forEach((transacao, index) => {
                const row = document.createElement("tr");

                const cellId = document.createElement("td");
                cellId.textContent = transacao.ID;
                row.appendChild(cellId);

                const cellTipo = document.createElement("td");
                cellTipo.textContent = transacao.TYPE;
                row.appendChild(cellTipo);

                const cellValor = document.createElement("td");
                cellValor.className = "text-end";
                cellValor.textContent = `R$ ${transacao.VALUE}`;
                row.appendChild(cellValor);

                const cellData = document.createElement("td");
                cellData.textContent = transacao.DATE;
                row.appendChild(cellData);

                tabelaTransactions.appendChild(row);
            });
        }

        function gerarPaginacao() {
            const totalPaginas = Math.ceil(transacoes.length / transacoesPorPagina);
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";

            for (let i = 1; i <= totalPaginas; i++) {
                const li = document.createElement("li");
                li.className = "page-item" + (i === paginaAtual ? " active" : "");

                const a = document.createElement("a");
                a.className = "page-link";
                a.textContent = i;
                a.href = "#";
                a.onclick = (event) => {
                    event.preventDefault();
                    paginaAtual = i;
                    atualizarTabela();
                    gerarPaginacao();
                };

                li.appendChild(a);
                pagination.appendChild(li);
            }
        }

        const walletId = 222;

        document.addEventListener('DOMContentLoaded', () => {
            fetchTransactions(walletId);
        });
    </script>

    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
        crossorigin="anonymous">
    </script>
</body>
</html>
