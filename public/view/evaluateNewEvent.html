<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluate Events</title>
    <link rel="stylesheet" href="../styles/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            margin-top: 20px;
        }

        #events-list {
            height: 70vh;
            overflow-y: auto;
        }

        .event-item {
            cursor: pointer;
        }

        .event-item:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <!-- Sidebar com a lista de eventos -->
            <div class="col-md-4">
                <h4 class="mb-3">Eventos Pendentes</h4>
                <ul class="list-group" id="events-list">
                    <!-- Eventos serão carregados aqui dinamicamente -->
                </ul>
            </div>

            <!-- Formulário de avaliação -->
            <div class="col-md-8">
                <h4 class="mb-3">Avaliar Evento</h4>
                <form id="evaluation-form" onsubmit="event.preventDefault(); evaluateEvent();">
                    <div class="mb-3">
                        <label for="event-id" class="form-label">ID do Evento</label>
                        <input type="number" class="form-control" id="event-id" placeholder="Selecione um evento ou insira o ID" required>
                    </div>

                    <div class="mb-3">
                        <label for="validity" class="form-label">Evento Válido?</label>
                        <select class="form-select" id="validity" required>
                            <option value="" selected disabled>Escolha uma opção</option>
                            <option value="sim">Sim</option>
                            <option value="não">Não</option>
                        </select>
                    </div>

                    <div class="mb-3" id="reason-group" style="display: none;">
                        <label for="reason" class="form-label">Motivo da Reprovação</label>
                        <textarea class="form-control" id="reason" rows="3" placeholder="Explique o motivo"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Avaliar</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('validity').addEventListener('change', function () {
            const reasonGroup = document.getElementById('reason-group');
            reasonGroup.style.display = this.value === 'não' ? 'block' : 'none';
        });

        async function fetchEvents() {
            const res = await fetch('http://127.0.0.1:3000/evaluateNewEvent', { 
                    method: 'PUT',
            });
            const events = await res.json();
            const eventsList = document.getElementById('events-list');

            eventsList.innerHTML = '';
            if (Array.isArray(events)) {
                events.forEach(event => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item event-item';
                    li.textContent = `ID: ${event.ID_EVENT} - ${event.TITLE}`;
                    li.onclick = () => {
                        document.getElementById('event-id').value = event.ID;
                    };
                    eventsList.appendChild(li);
                });
            } else {
                eventsList.innerHTML = `<li class="list-group-item text-center">${events}</li>`;
            }
        }

        async function evaluateEvent() {
            const id = document.getElementById('event-id').value;
            const validity = document.getElementById('validity').value;
            const reason = document.getElementById('reason').value;

            if (validity === 'não' && !reason) {
                alert('Por favor, forneça um motivo para reprovar o evento.');
                return;
            }

            const headers = new Headers();
            headers.append('eventID', id);
            headers.append('isValid', validity);
            if (validity === 'não') headers.append('reason', reason);

            const res = await fetch('http://127.0.0.1:3000/evaluateNewEvent', {
                method: 'PUT',
                headers,
            });

            const message = await res.text();
            alert(message);
            fetchEvents(); // Atualiza a lista de eventos
        }

        window.onload = fetchEvents;
    </script>
</body>
</html>
